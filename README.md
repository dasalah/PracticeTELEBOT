# ربات تلگرام ثبتنام رویداد - Event Registration Telegram Bot

یک ربات تلگرام پیشرفته و کامل برای مدیریت ثبت‌نام کاربران در رویدادها با قابلیت‌های شامل مدیریت رویدادها، تایید ثبت‌نام‌ها، و صدور گزارش‌های Excel.

## ویژگی‌ها

### 🎭 مدیریت رویدادها
- ایجاد رویداد با نام، توضیحات، پوستر، مبلغ و شماره کارت
- تنظیم ظرفیت و تاریخ‌های شروع/پایان ثبت‌نام
- تولید کد و لینک یکتا برای هر رویداد: `t.me/botname?start=event_code`
- مدیریت وضعیت رویداد (فعال/غیرفعال/پر/منقضی)

### 📝 فرآیند ثبت‌نام کاربر
- شروع ثبت‌نام از طریق لینک اختصاصی رویداد
- نمایش اطلاعات کامل رویداد و پوستر
- مراحل ثبت‌نام شامل:
  1. نمایش اطلاعات پرداخت
  2. دریافت نام و نام خانوادگی
  3. دریافت و اعتبارسنجی کد ملی ایرانی
  4. دریافت و اعتبارسنجی شماره تلفن ایرانی
  5. دریافت فیش واریزی (عکس یا متن)
  6. تایید نهایی اطلاعات

### 🛠 سیستم مدیریت
- تشخیص خودکار ادمین اصلی و ادمین‌های فرعی
- تایید/رد ثبت‌نام‌ها با امکان مشاهده فیش
- آمار کامل سیستم و رویدادها
- تولید و ارسال فایل‌های Excel جامع

### 🗄 پایگاه داده جامع
- مدیریت کاربران، رویدادها، ثبت‌نام‌ها
- ثبت ادمین‌ها و سطوح دسترسی
- لاگ کامل فعالیت‌ها و پیام‌ها
- ذخیره ثبت‌نام‌های رد شده

### ✅ اعتبارسنجی پیشرفته
- اعتبارسنجی کد ملی ایرانی با الگوریتم استاندارد
- پشتیبانی از فرمت‌های مختلف شماره تلفن ایرانی
- تبدیل خودکار اعداد فارسی به انگلیسی
- بررسی تکراری نبودن ثبت‌نام‌ها

## نصب و راه‌اندازی

### پیش‌نیازها
- Python 3.8+
- حساب توسعه‌دهنده تلگرام (API_ID و API_HASH)
- ربات تلگرام (BOT_TOKEN)

### مراحل نصب

1. **کلون پروژه:**
```bash
git clone https://github.com/dasalah/PracticeTELEBOT
cd PracticeTELEBOT
```

2. **نصب وابستگی‌ها:**
```bash
pip install -r requirements.txt
```

3. **تنظیم متغیرهای محیط:**
```bash
cp .env.example .env
# ویرایش فایل .env و تنظیم متغیرها
```

4. **تست سیستم:**
```bash
python test_integration.py
```

5. **ایجاد داده‌های نمونه:**
```bash
python create_sample_data.py
```

6. **اجرای ربات:**
```bash
python run.py
```

## ساختار پروژه

```
telegram-event-bot/
├── main.py                 # فایل اصلی بات
├── handlers/
│   ├── __init__.py
│   ├── registration.py     # هندلرهای ثبتنام
│   ├── admin.py           # هندلرهای ادمین
│   └── callbacks.py       # کالبک هندلرها
├── models/
│   ├── __init__.py
│   └── database.py        # مدلهای دیتابیس
├── utils/
│   ├── __init__.py
│   ├── validation.py      # اعتبارسنجی کد ملی و تلفن
│   ├── excel_export.py    # تولید فایل Excel
│   └── helpers.py         # توابع کمکی
├── config.py              # تنظیمات
├── run.py                 # فایل اجرا
├── test_integration.py    # تست یکپارچه سیستم
├── create_sample_data.py  # ایجاد داده‌های نمونه
├── requirements.txt       # وابستگیها
├── .env.example          # نمونه فایل محیط
├── .gitignore           # فایل‌های قابل نادیده گیری
├── old_files/           # فایل‌های قدیمی (بک‌آپ)
├── receipts/            # پوشه فیش‌های واریزی
├── posters/             # پوشه پوسترهای رویدادها
└── exports/             # پوشه فایل‌های Excel
```

## تنظیمات

### متغیرهای محیط (.env)

```env
# Telegram Bot Configuration
API_ID=your_api_id
API_HASH=your_api_hash
BOT_TOKEN=your_bot_token

# Super Admin Telegram ID
SUPER_ADMIN_ID=your_telegram_id

# Database Configuration
DATABASE_URL=sqlite:///event_bot.db

# File Upload Configuration
MAX_FILE_SIZE=10485760

# Session Configuration
SESSION_NAME=event_bot_session

# Logging Configuration
LOG_LEVEL=INFO
LOG_FILE=bot.log
```

## نحوه استفاده

### برای کاربران عادی
1. کلیک روی لینک اختصاصی رویداد: `t.me/botname?start=event_code`
2. مشاهده اطلاعات رویداد و پرداخت مبلغ
3. شروع ثبت‌نام و وارد کردن اطلاعات
4. ارسال فیش واریزی
5. انتظار برای تایید ادمین

### برای ادمین‌ها
- استفاده از دستور `/admin` یا `/start` برای دسترسی به پنل
- مدیریت رویدادها و تایید ثبت‌نام‌ها
- دریافت گزارش‌های Excel
- مشاهده آمار سیستم

## دستورات ربات

### دستورات کاربر
- `/start` - شروع یا دسترسی به لینک رویداد
- `/status` - بررسی وضعیت ثبت‌نام

### دستورات ادمین
- `/admin` - دسترسی به پنل مدیریت
- `/start` - پنل مدیریت (برای ادمین‌ها)

## آزمایش سیستم

برای اطمینان از عملکرد صحیح سیستم:

```bash
# آزمایش یکپارچه کل سیستم
python test_integration.py

# ایجاد داده‌های نمونه برای تست
python create_sample_data.py
```

## ویژگی‌های امنیتی

- اعتبارسنجی کامل ورودی‌ها
- محدودیت دسترسی مبتنی بر نقش
- لاگ کامل تمام فعالیت‌ها
- مدیریت امن جلسات کاربر

## تکنولوژی‌ها

- **Telethon** - کتابخانه کلاینت تلگرام
- **SQLAlchemy** - ORM پایگاه داده
- **openpyxl** - کار با فایل‌های Excel
- **python-dotenv** - مدیریت متغیرهای محیط

## تغییرات نسبت به نسخه قبلی

- 🔄 بازنویسی کامل ساختار پروژه
- 🗄️ طراحی مجدد پایگاه داده
- 🛠️ اضافه شدن سیستم مدیریت جامع
- ✅ پیاده‌سازی اعتبارسنجی پیشرفته
- 📊 سیستم گزارش‌گیری Excel
- 🔒 بهبود امنیت و لاگ‌گیری

## پشتیبانی

برای گزارش مشکلات یا درخواست ویژگی جدید، لطفا از بخش Issues گیت‌هاب استفاده کنید.

## مجوز

این پروژه تحت مجوز MIT منتشر شده است.